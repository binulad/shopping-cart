<div class="card">
  <div class="card-header d-flex align-items-center justify-content-between">
    <h5 class="card-title my-2">{{isEdit ? "Edit Recipe" : "New Recipe"}}</h5>
  </div>
  <div class="card-body">

    <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()">
      <div class="mb-3">
        <label for="name" class="form-label">Recipe Name</label>
        <input type="text" class="form-control" [ngClass]="{'is-invalid': validateField('name')}" id="name"
          formControlName="name" placeholder="Enter the Recipe Name">
        <div *ngIf="validateField('name')" class="invalid-feedback">
          This field is required
        </div>
      </div>

      <div class="mb-3">
        <label for="description" class="form-label">Recipe Description</label>
        <textarea class="form-control" [ngClass]="{'is-invalid': validateField('description')}" id="description"
          formControlName="description" placeholder="Enter the Recipe Description" rows="4"></textarea>
        <div *ngIf="validateField('description')" class="invalid-feedback">
          This field is required
        </div>
      </div>

      <div class="d-flex gap-3 mb-3">
        <div class="flex-grow-1">
          <label for="imagePath" class="form-label">Image Path</label>
          <input type="text" class="form-control" [ngClass]="{'is-invalid': validateField('imagePath')}" id="imagePath"
            formControlName="imagePath" placeholder="Enter the Image Path">
          <div *ngIf="validateField('imagePath')" class="invalid-feedback">
            This field is required
          </div>
        </div>

        <div class="flex-shrink-0 recipe-img" *ngIf="recipeForm.get('imagePath')?.value">
          <img [src]="recipeForm.get('imagePath')?.value" class="rounded" alt="Recipe Image">
        </div>
      </div>

      <div class="mb-3">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <label for="ingredients" class="form-label mb-0">Ingredients</label>
          <button type="button" class="btn btn-link btn-link-primary" title="Add Ingredient"
            (click)="addIngredients()">Add Ingredient</button>
        </div>

        <div formArrayName="ingredients">
          <div class="row mb-2 g-2" [formGroupName]="i" *ngFor="let ingredient of ingredients.controls, let i=index">
            <div class="col">
              <input type="text" class="form-control"
                [ngClass]="{'is-invalid':!ingredient.get('name')?.valid && ingredient.get('name')?.touched}"
                formControlName="name" placeholder="Enter Ingredient Name">
              <div *ngIf="!ingredient.get('name')?.valid && ingredient.get('name')?.touched"
                class="invalid-feedback">
                This field is required
              </div>
            </div>
            <div class="col-lg-4 form-group">
              <input type="number" class="form-control"
                [ngClass]="{'is-invalid':!ingredient.get('amount')?.valid && ingredient.get('amount')?.touched}"
                formControlName="amount" placeholder="Enter Amount">
              <div *ngIf="!ingredient.get('amount')?.valid && ingredient.get('amount')?.touched"
                class="invalid-feedback">
                This field is required
              </div>
            </div>
            <div class="col-auto">
              <button type="button" class="btn btn-danger" (click)="onDelete(i)">X</button>
            </div>
          </div>
        </div>
      </div>

      <hr>

      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-primary px-3" [disabled]="!recipeForm.valid">Save</button>
        <button type="button" class="btn btn-secondary px-3 ms-2" (click)="handleCancel()">Cancel</button>
      </div>
    </form>

  </div>
</div>